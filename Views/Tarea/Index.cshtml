@{
    ViewData["Title"] = "Tareas";
}

@using Tp11.ViewModels
@model ListarTareasViewModel

<div class="container mt-4"> <!-- Agregado un contenedor para alinear el botón -->
    <div class="row mb-3">
        <div class="col">
            <div class="btn-group" role="group">

            <a class="btn btn-success mr-2" asp-controller="Tarea" asp-action="AgregarTarea">
                <i class="fas fa-plus-circle"></i> Agregar Tarea
            </a>
            @if(Model.VerTableroIndividual)
            {
                @if(Model.IsAdmin){
                    <a class="btn btn-info ml-2" asp-controller="Tarea" asp-action="Index">
                        <i class="fas fa-list"></i> Ver todas las tareas
                    </a>
                } else if(!Model.IsAdmin) {
                    <a class="btn btn-info ml-2" asp-controller="Tarea" asp-action="Index">
                        <i class="fas fa-list"></i> Ver mis tareas
                    </a>
                }
            }
            </div>
        </div>      
</div>

<table class="table table-striped table-bordered table-bordered-custom ">
    <thead class="thead-dark">
        @if(Model.VerTableroIndividual){
            <th colspan="7" class="text-center display-5 text-primary font-weight-bold">Tareas del tablero: @Model.NombreDelTablero</th>
        }else {
            <th colspan="7" class="text-center display-5 text-primary font-weight-bold">@{ string titulo = Model.IsAdmin ? "Todas las tareas" : "Tareas de mis tableros / Tareas asignadas"; } @titulo</th>
        }
        <tr>
            <th hidden>ID</th>
            <th hidden>IdTablero</th>
            <th>Nombre</th>
            <th>Estado</th>
            <th>Descripcion</th>
            <th>Color</th>
            <th hidden>IdUsuarioAsignado</th>
            <th >Usuario Asignado</th>
            <th>Propietario</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
            @foreach (var tarea in Model.ListaTareas)
            {
                <tr>
                    <td hidden>@tarea.Id</td>
                    <td hidden>@tarea.IdTablero</td>
                    <td>@tarea.Nombre</td>
                    <td>@(tarea.Estado.ToString())</td>
                    <td>@tarea.Descripcion</td>
                    <td>@tarea.Color</td>
                    <td hidden>@tarea.IdUsuarioAsignado</td>
                    <td>@tarea.NombreUsuarioAsignado</td>
                    <td>@tarea.NombreUsuarioPropietario</td>
                    <td>
                        @if(Model.IsAdmin)
                        {
                            <a class="btn btn-primary" asp-controller="Tarea" asp-action="UpdateTarea" asp-route-idTarea="@tarea.Id">
                                <i class="fas fa-edit"></i> Editar
                            </a>
                            <a class="btn btn-danger" asp-controller="Tarea" asp-action="EliminarTarea" asp-route-idTarea="@tarea.Id" onclick="return confirm('¿Estás seguro que quieres eliminar el elemento?')">
                                <i class="fas fa-trash-alt"></i> Eliminar
                            </a>
                        }else if(Model.IdUsuarioLogueado == tarea.IdPropietario){
                            @if(tarea.IdUsuarioAsignado == -1){ // No fue asignada a nadie
                                <a class="btn btn-primary" asp-controller="Tarea" asp-action="AsignarTarea" asp-route-idTarea="@tarea.Id">
                                    <i class="fas fa-sync-alt"></i>Asignar
                                </a>    
                            } else{
                                <a class="btn btn-primary" asp-controller="Tarea" asp-action="AsignarTarea" asp-route-idTarea="@tarea.Id">
                                    <i class="fas fa-sync-alt"></i>Reasignar
                                </a>   
                            }
                        }

                        @if(Model.IdUsuarioLogueado == tarea.IdUsuarioAsignado){   
                            <a class="btn btn-success" asp-controller="Tarea" asp-action="UpdateTarea" asp-route-idTarea="@tarea.Id">
                                <i class="fas fa-check"></i> Actualizar Estado
                            </a>
                        }
                    </td>
                </tr>            
        }
    </tbody>
    <tfoot>
        
    </tfoot>
</table>

@section Scripts { <partial name="_ValidationScriptsPartial" /> }